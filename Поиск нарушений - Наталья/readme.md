# neuroCRM — Поиск нарушений

## Описание
Комплексная автоматизация для поиска нарушений авторских прав на основе изображения.

Функциональность:
- принимает **фотографию**, по которой нужно искать возможные нарушения;
- находит **контактные данные**, **e-mail**, а также **ИНН**, если он присутствует на найденных страницах;
- получает **данные компании** через сервис **EGRUL** по ИНН*;
- сохраняет PDF-выписку EGRUL в **Google Диск** и добавляет запись в таблицу;
- по доменному имени через **WHOIS** получает дополнительную информацию;
- формирует итоговую **Google Таблицу** со всеми найденными совпадениями и данными;
- по нажатию на **кастомную кнопку** в таблице автоматически создаёт сделку в **Bitrix24**.

---

## Используемые интеграции

### 1. **Bitrix24 API**
- Приём данных через входящий вебхук.
- Методы:
  - `crm.deal.add.json`,
  - `crm.company.list.json`,
  - `crm.company.add.json`.
- Автоматическое создание компании при отсутствии и использование существующей записи при совпадении ИНН.

### 2. **n8n Function / Code Nodes**
- Парсинг HTML страниц.
- Формирование запросов к сервисам (EGRUL, WHOIS и т.д.).
- Заполнение итоговой таблицы нарушений.

### 3. **Yandex Cloud Vision / Image Search**
- Поиск похожих изображений по загруженной фотографии.
- Обнаружение страниц, где используется потенциально нарушающий контент.

### 4. **Google Apps Script**
- Создание кастомной кнопки в таблице.
- Отправка данных из таблицы на вебхук bitrix (создание сделок в Bitrix24).

### 5. **EGRUL API**
- Получение данных о юридическом лице/ИП по ИНН.
- Загрузка полного файла ЕГРЮЛ/ЕГРИП на Google Диск.
- Сохранение ссылки на файл в таблицу нарушений.

### 6. **WHOIS**
- Получение информации о домене (ИНН, номер и другие контактные данные)

### 7. **Google Cloud**
- Подключение Google Sheets для записи результатов.
- Работа с Google Drive для хранения файлов и документов.

### 8. **Web Archive**
- По возможности, сохранения архив версии веб страницы для доказательств
---

## Как запустить

1. **Импортируйте `workflow.json` в n8n`.**

2. **Настройте параметры:**
   - входящий вебхук из Bitrix24;
   - API-ключ и `folderId` для Yandex Cloud;
   - доступы Google Cloud (Service Account) для Google Sheets и Google Drive.

3. **Адаптируйте поля под вашу CRM-схему:**
   - ID полей, колонок и структур данных в Google Apps Script;
   - кастомные поля вида `UF_CRM_*`;
   - названия полей компании и контакта в Bitrix24.

4. **Протестируйте процесс:**
   - загрузите тестовую фотографию в триггер-форму;
   - убедитесь, что workflow:
     - корректно подтягивает данные;
     - выполняет запросы к сервисам EGRUL, WHOIS и Yandex Cloud;
     - получает HTML страниц и успешно их парсит;
     - формирует и записывает Google Таблицу;
     - добавляет кастомную кнопку;
     - по нажатию кнопки данные корректно отправляются в битрикс;
     - создаётся сделка в Bitrix24 с необходимыми полями.

---
